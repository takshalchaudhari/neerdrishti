<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Neerdrishti – Live Data</title>
<script src="paho-mqtt.js"></script>

<style>
body{
  background:#050d12;
  color:#0f0;
  font-family:monospace;
  text-align:center;
}
#status{color:#ff0}
#data{font-size:18px;margin-top:20px}
</style>
</head>

<body>

<h2>Neerdrishti – MQTT Live Monitor</h2>
<p id="status">Connecting to MQTT…</p>

<div id="data">
Front: <span id="f">--</span><br>
Left: <span id="l">--</span><br>
Right: <span id="r">--</span>
</div>

<script>
const statusEl = document.getElementById("status");
let lastMsg = 0;

// ⚠️ PUBLIC SUBSCRIBER ONLY (NO CREDENTIALS HERE)
const client = new Paho.Client(
  "4d679eb8c29c4e029130d4045c0c1a2e.s1.eu.hivemq.cloud",
  8884,
  "/mqtt",
  "web_"+Math.random().toString(16).slice(2)
);

client.onConnectionLost = () => {
  statusEl.innerText = "MQTT connection lost";
};

client.onMessageArrived = m => {
  try{
    const j = JSON.parse(m.payloadString);
    f.innerText = j.front;
    l.innerText = j.left;
    r.innerText = j.right;
    lastMsg = Date.now();
    statusEl.innerText = "Receiving live data";
  }catch(e){
    console.log("Bad JSON", e);
  }
};

client.connect({
  useSSL:true,
  onSuccess:()=>{
    statusEl.innerText = "Connected. Waiting for data…";
    client.subscribe("neerdrishti/sonar/map");
  },
  onFailure:()=>{
    statusEl.innerText = "MQTT connection failed";
  }
});

// watchdog
setInterval(()=>{
  if(Date.now() - lastMsg > 3000){
    statusEl.innerText = "No data received";
  }
},1000);
</script>

</body>
</html>
